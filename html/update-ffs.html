<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<title>Update Flash Filesystem</title>
<style type='text/css'>
body {
    font-family: sans-serif;
    margin-left: 20px;
}
</style>
<script type='text/javascript'>

    function loadFile() {
        var input, file, fr;

        if (typeof window.FileReader !== 'function') {
            //setMessage("The file API isn't supported on this browser yet.");
            //return;
        }

        input = document.getElementById('fileinput');
        if (!input) {
            setMessage("Couldn't find the fileinput element.");
        }
        else if (!input.files) {
            setMesssage("This browser doesn't seem to support the `files` property of file inputs.");
        }
        else if (!input.files[0]) {
            setMessage("No files selected.");
        }
        else {
            file = input.files[0];
            updateFirmware(file);
        }
    }

    function setMessage(msg) {
        var message = document.getElementById('message');
        message.innerHTML = msg;
    };

    function updateFirmware(file) {
      var req = new XMLHttpRequest();
      req.open('POST', '/flash/write?address=0x100000', true);
      req.onload = function (e) {
        if (this.readyState == 4) {
            if (this.status == 200)
                setMessage("Filesystem Updated!");
            else
                setMessage("Filesystem Update Failed!");
        }
      };

      // Listen to the upload progress.
      var progressBar = document.getElementById('progress');
      req.upload.onprogress = function (e) {
        if (e.lengthComputable) {
          progressBar.value = (e.loaded / e.total) * 100;
          progressBar.textContent = progressBar.value; // Fallback for unsupported browsers.
        }
      };

      req.send(file);
    }
</script>
</head>
<body>
<form action='#' onsubmit="return false;">
<h1>Select a Filesystem Image to Load</h1>
<p>
  <input type='file' id='fileinput' onchange='loadFile();'>
</p>
<p>
  <progress id='progress' min="0" max="100" value="0">0% complete</progress>
  <p id='message'>&nbsp;</p>
</p>
</form>
</body>
</html>

